import fs from 'fs';
import { parse } from 'path';
const START = '<svg';
const WIDTH_SEARCH = 'width="';
const HEIGHT_SEARCH = 'height="';
function wrapIcon(source, name) {
    const src = source.slice(Math.max(0, source.indexOf(START)));
    const attributes = src.slice(0, Math.max(0, src.indexOf('>')));
    if (!(attributes === null || attributes === void 0 ? void 0 : attributes.includes(WIDTH_SEARCH)) || !attributes.includes(HEIGHT_SEARCH)) {
        return src;
    }
    const indexOfWidth = attributes.indexOf(WIDTH_SEARCH);
    const indexOfHeight = attributes.indexOf(HEIGHT_SEARCH);
    const widthOffset = indexOfWidth + WIDTH_SEARCH.length;
    const heightOffset = indexOfHeight + HEIGHT_SEARCH.length;
    const widthString = attributes.slice(widthOffset, attributes.indexOf('"', widthOffset));
    const heightString = attributes.slice(heightOffset, attributes.indexOf('"', heightOffset));
    if (!heightString ||
        !widthString ||
        widthString.includes('%') ||
        heightString.includes('%')) {
        return src.replace(START, `<svg id="${name}"`);
    }
    const width = parseInt(widthString, 10);
    const height = parseInt(heightString, 10);
    const emWidth = width / 16;
    const emHeight = height / 16;
    return {
        width: `${emWidth}em`,
        height: `${emHeight}em`,
        src: `
        <g id="${name}" xmlns="http://www.w3.org/2000/svg">
            <svg x="50%" y="50%" width="${emWidth}em" height="${emHeight}em" overflow="visible" viewBox="0 0 ${width} ${height}">
                <svg x="${-width / 2}" y="${-height / 2}">${src}</svg>
            </svg>
        </g>`.trim(),
    };
}
export function tuiProcessIcons(files, interceptor) {
    for (const file of files) {
        const baseContent = String(fs.readFileSync(file));
        const src = interceptor ? interceptor(baseContent) : baseContent;
        const name = parse(file).base.replace('.svg', '');
        if (src.includes(`id="${name}"`) || name.includes('Outline')) {
            console.info('\x1B[33m%s\x1B[0m', '[skip]:', file);
            continue;
        }
        const wrapped = wrapIcon(src, name);
        const final = typeof wrapped === 'string'
            ? `${wrapped.replace(START, `<svg xmlns="http://www.w3.org/2000/svg"><g id="${name}" xmlns="http://www.w3.org/2000/svg"><svg`)}</g></svg>`
            : `<svg xmlns="http://www.w3.org/2000/svg" width="${wrapped.width}" height="${wrapped.height}">${wrapped.src}</svg>`;
        fs.writeFileSync(file, final);
        console.info('\x1B[32m%s\x1B[0m', '[preprocessed]:', file);
    }
}
/**
 * @deprecated:
 * use @{link tuiProcessIcons}
 */
export const processIcons = tuiProcessIcons;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1pY29ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL2ljb25zL3NjcmlwdHMvcHJvY2Vzcy1pY29ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFDcEIsT0FBTyxFQUFDLEtBQUssRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUUzQixNQUFNLEtBQUssR0FBRyxNQUFNLENBQUM7QUFDckIsTUFBTSxZQUFZLEdBQUcsU0FBUyxDQUFDO0FBQy9CLE1BQU0sYUFBYSxHQUFHLFVBQVUsQ0FBQztBQVVqQyxTQUFTLFFBQVEsQ0FBQyxNQUFjLEVBQUUsSUFBWTtJQUMxQyxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzdELE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRS9ELElBQUksQ0FBQyxDQUFBLFVBQVUsYUFBVixVQUFVLHVCQUFWLFVBQVUsQ0FBRSxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUEsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUU7UUFDNUUsT0FBTyxHQUFHLENBQUM7S0FDZDtJQUVELE1BQU0sWUFBWSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDdEQsTUFBTSxhQUFhLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUN4RCxNQUFNLFdBQVcsR0FBRyxZQUFZLEdBQUcsWUFBWSxDQUFDLE1BQU0sQ0FBQztJQUN2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QVksR0FBRyxlQUFlLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHtwYXJzZX0gZnJvbSAncGF0aCc7XG5cbmNvbnN0IFNUQVJUID0gJzxzdmcnO1xuY29uc3QgV0lEVEhfU0VBUkNIID0gJ3dpZHRoPVwiJztcbmNvbnN0IEhFSUdIVF9TRUFSQ0ggPSAnaGVpZ2h0PVwiJztcblxuaW50ZXJmYWNlIFdyYXBwZWRDb250ZW50IHtcbiAgICBoZWlnaHQ6IHN0cmluZztcbiAgICBzcmM6IHN0cmluZztcbiAgICB3aWR0aDogc3RyaW5nO1xufVxuXG50eXBlIENvbnRlbnRJbnRlcmNlcHRvciA9IChzcmM6IHN0cmluZykgPT4gc3RyaW5nO1xuXG5mdW5jdGlvbiB3cmFwSWNvbihzb3VyY2U6IHN0cmluZywgbmFtZTogc3RyaW5nKTogV3JhcHBlZENvbnRlbnQgfCBzdHJpbmcge1xuICAgIGNvbnN0IHNyYyA9IHNvdXJjZS5zbGljZShNYXRoLm1heCgwLCBzb3VyY2UuaW5kZXhPZihTVEFSVCkpKTtcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0gc3JjLnNsaWNlKDAsIE1hdGgubWF4KDAsIHNyYy5pbmRleE9mKCc+JykpKTtcblxuICAgIGlmICghYXR0cmlidXRlcz8uaW5jbHVkZXMoV0lEVEhfU0VBUkNIKSB8fCAhYXR0cmlidXRlcy5pbmNsdWRlcyhIRUlHSFRfU0VBUkNIKSkge1xuICAgICAgICByZXR1cm4gc3JjO1xuICAgIH1cblxuICAgIGNvbnN0IGluZGV4T2ZXaWR0aCA9IGF0dHJpYnV0ZXMuaW5kZXhPZihXSURUSF9TRUFSQ0gpO1xuICAgIGNvbnN0IGluZGV4T2ZIZWlnaHQgPSBhdHRyaWJ1dGVzLmluZGV4T2YoSEVJR0hUX1NFQVJDSCk7XG4gICAgY29uc3Qgd2lkdGhPZmZzZXQgPSBpbmRleE9mV2lkdGggKyBXSURUSF9TRUFSQ0gubGVuZ3RoO1xuICAgIGNvbnN0IGhlaWdodE9mZnNldCA9IGluZGV4T2ZIZWlnaHQgKyBIRUlHSFRfU0VBUkNILmxlbmd0aDtcbiAgICBjb25zdCB3aWR0aFN0cmluZyA9IGF0dHJpYnV0ZXMuc2xpY2UoXG4gICAgICAgIHdpZHRoT2Zmc2V0LFxuICAgICAgICBhdHRyaWJ1dGVzLmluZGV4T2YoJ1wiJywgd2lkdGhPZmZzZXQpLFxuICAgICk7XG4gICAgY29uc3QgaGVpZ2h0U3RyaW5nID0gYXR0cmlidXRlcy5zbGljZShcbiAgICAgICAgaGVpZ2h0T2Zmc2V0LFxuICAgICAgICBhdHRyaWJ1dGVzLmluZGV4T2YoJ1wiJywgaGVpZ2h0T2Zmc2V0KSxcbiAgICApO1xuXG4gICAgaWYgKFxuICAgICAgICAhaGVpZ2h0U3RyaW5nIHx8XG4gICAgICAgICF3aWR0aFN0cmluZyB8fFxuICAgICAgICB3aWR0aFN0cmluZy5pbmNsdWRlcygnJScpIHx8XG4gICAgICAgIGhlaWdodFN0cmluZy5pbmNsdWRlcygnJScpXG4gICAgKSB7XG4gICAgICAgIHJldHVybiBzcmMucmVwbGFjZShTVEFSVCwgYDxzdmcgaWQ9XCIke25hbWV9XCJgKTtcbiAgICB9XG5cbiAgICBjb25zdCB3aWR0aCA9IHBhcnNlSW50KHdpZHRoU3RyaW5nLCAxMCk7XG4gICAgY29uc3QgaGVpZ2h0ID0gcGFyc2VJbnQoaGVpZ2h0U3RyaW5nLCAxMCk7XG4gICAgY29uc3QgZW1XaWR0aCA9IHdpZHRoIC8gMTY7XG4gICAgY29uc3QgZW1IZWlnaHQgPSBoZWlnaHQgLyAxNjtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHdpZHRoOiBgJHtlbVdpZHRofWVtYCxcbiAgICAgICAgaGVpZ2h0OiBgJHtlbUhlaWdodH1lbWAsXG4gICAgICAgIHNyYzogYFxuICAgICAgICA8ZyBpZD1cIiR7bmFtZX1cIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI+XG4gICAgICAgICAgICA8c3ZnIHg9XCI1MCVcIiB5PVwiNTAlXCIgd2lkdGg9XCIke2VtV2lkdGh9ZW1cIiBoZWlnaHQ9XCIke2VtSGVpZ2h0fWVtXCIgb3ZlcmZsb3c9XCJ2aXNpYmxlXCIgdmlld0JveD1cIjAgMCAke3dpZHRofSAke2hlaWdodH1cIj5cbiAgICAgICAgICAgICAgICA8c3ZnIHg9XCIkey13aWR0aCAvIDJ9XCIgeT1cIiR7LWhlaWdodCAvIDJ9XCI+JHtzcmN9PC9zdmc+XG4gICAgICAgICAgICA8L3N2Zz5cbiAgICAgICAgPC9nPmAudHJpbSgpLFxuICAgIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0dWlQcm9jZXNzSWNvbnMoZmlsZXM6IHN0cmluZ1tdLCBpbnRlcmNlcHRvcj86IENvbnRlbnRJbnRlcmNlcHRvcik6IHZvaWQge1xuICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykge1xuICAgICAgICBjb25zdCBiYXNlQ29udGVudCA9IFN0cmluZyhmcy5yZWFkRmlsZVN5bmMoZmlsZSkpO1xuICAgICAgICBjb25zdCBzcmMgPSBpbnRlcmNlcHRvciA/IGludGVyY2VwdG9yKGJhc2VDb250ZW50KSA6IGJhc2VDb250ZW50O1xuXG4gICAgICAgIGNvbnN0IG5hbWUgPSBwYXJzZShmaWxlKS5iYXNlLnJlcGxhY2UoJy5zdmcnLCAnJyk7XG5cbiAgICAgICAgaWYgKHNyYy5pbmNsdWRlcyhgaWQ9XCIke25hbWV9XCJgKSB8fCBuYW1lLmluY2x1ZGVzKCdPdXRsaW5lJykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuaW5mbygnXFx4MUJbMzNtJXNcXHgxQlswbScsICdbc2tpcF06JywgZmlsZSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdyYXBwZWQgPSB3cmFwSWNvbihzcmMsIG5hbWUpO1xuXG4gICAgICAgIGNvbnN0IGZpbmFsID1cbiAgICAgICAgICAgIHR5cGVvZiB3cmFwcGVkID09PSAnc3RyaW5nJ1xuICAgICAgICAgICAgICAgID8gYCR7d3JhcHBlZC5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgICAgIFNUQVJULFxuICAgICAgICAgICAgICAgICAgICAgIGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIj48ZyBpZD1cIiR7bmFtZX1cIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI+PHN2Z2AsXG4gICAgICAgICAgICAgICAgICApfTwvZz48L3N2Zz5gXG4gICAgICAgICAgICAgICAgOiBgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIke3dyYXBwZWQud2lkdGh9XCIgaGVpZ2h0PVwiJHt3cmFwcGVkLmhlaWdodH1cIj4ke3dyYXBwZWQuc3JjfTwvc3ZnPmA7XG5cbiAgICAgICAgZnMud3JpdGVGaWxlU3luYyhmaWxlLCBmaW5hbCk7XG5cbiAgICAgICAgY29uc29sZS5pbmZvKCdcXHgxQlszMm0lc1xceDFCWzBtJywgJ1twcmVwcm9jZXNzZWRdOicsIGZpbGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAZGVwcmVjYXRlZDpcbiAqIHVzZSBAe2xpbmsgdHVpUHJvY2Vzc0ljb25zfVxuICovXG5leHBvcnQgY29uc3QgcHJvY2Vzc0ljb25zID0gdHVpUHJvY2Vzc0ljb25zO1xuIl19