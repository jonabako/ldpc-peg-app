{"version":3,"file":"taiga-ui-kit-directives-highlight.umd.js","sources":["../../../projects/kit/directives/highlight/highlight.directive.ts","../../../projects/kit/directives/highlight/highlight.module.ts","../../../projects/kit/directives/highlight/taiga-ui-kit-directives-highlight.ts"],"sourcesContent":["import {DOCUMENT} from '@angular/common';\nimport {Directive, ElementRef, Inject, Input, OnChanges, Renderer2} from '@angular/core';\nimport {svgNodeFilter, TuiDestroyService, tuiPx, TuiResizeService} from '@taiga-ui/cdk';\nimport {Observable} from 'rxjs';\n\n@Directive({\n    selector: '[tuiHighlight]',\n    providers: [TuiDestroyService, TuiResizeService],\n    host: {\n        '[style.position]': '\"relative\"',\n        '[style.zIndex]': '0',\n    },\n})\nexport class TuiHighlightDirective implements OnChanges {\n    private readonly highlight: HTMLElement = this.setUpHighlight();\n\n    private readonly treeWalker = this.doc.createTreeWalker(\n        this.el.nativeElement,\n        NodeFilter.SHOW_TEXT,\n        svgNodeFilter,\n    );\n\n    @Input()\n    tuiHighlight = '';\n\n    @Input()\n    tuiHighlightColor = 'var(--tui-selection)';\n\n    constructor(\n        @Inject(DOCUMENT) private readonly doc: Document,\n        @Inject(ElementRef) private readonly el: ElementRef<HTMLElement>,\n        @Inject(Renderer2) private readonly renderer: Renderer2,\n        @Inject(TuiResizeService) resize$: Observable<unknown>,\n    ) {\n        resize$.subscribe(() => {\n            this.updateStyles();\n        });\n    }\n\n    get match(): boolean {\n        return this.indexOf(this.el.nativeElement.textContent) !== -1;\n    }\n\n    ngOnChanges(): void {\n        this.updateStyles();\n    }\n\n    private updateStyles(): void {\n        this.highlight.style.display = 'none';\n\n        if (!this.match) {\n            return;\n        }\n\n        this.treeWalker.currentNode = this.el.nativeElement;\n\n        do {\n            const index = this.indexOf(this.treeWalker.currentNode.nodeValue);\n\n            if (index === -1) {\n                continue;\n            }\n\n            const range = this.doc.createRange();\n\n            range.setStart(this.treeWalker.currentNode, index);\n            range.setEnd(this.treeWalker.currentNode, index + this.tuiHighlight.length);\n\n            const hostRect = this.el.nativeElement.getBoundingClientRect();\n            const {left, top, width, height} = range.getBoundingClientRect();\n            const {style} = this.highlight;\n\n            style.background = this.tuiHighlightColor;\n            style.left = tuiPx(left - hostRect.left);\n            style.top = tuiPx(top - hostRect.top);\n            style.width = tuiPx(width);\n            style.height = tuiPx(height);\n            style.display = 'block';\n\n            return;\n        } while (this.treeWalker.nextNode());\n    }\n\n    private indexOf(source: string | null): number {\n        return !source || !this.tuiHighlight\n            ? -1\n            : source.toLowerCase().indexOf(this.tuiHighlight.toLowerCase());\n    }\n\n    private setUpHighlight(): HTMLElement {\n        const highlight = this.renderer.createElement('div');\n        const {style} = highlight;\n\n        style.background = this.tuiHighlightColor;\n        style.zIndex = '-1';\n        style.position = 'absolute';\n        this.renderer.appendChild(this.el.nativeElement, highlight);\n\n        return highlight;\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiHighlightDirective} from './highlight.directive';\n\n@NgModule({\n    declarations: [TuiHighlightDirective],\n    exports: [TuiHighlightDirective],\n})\nexport class TuiHighlightModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["svgNodeFilter","tuiPx","i0","DOCUMENT","ElementRef","Renderer2","TuiResizeService","TuiDestroyService","Directive","Inject","Input","NgModule"],"mappings":"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"}