import { __decorate } from "tslib";
import { Directive, ElementRef, Inject, Input } from '@angular/core';
import { USER_AGENT } from '@ng-web-apis/common';
import { CHROMIUM_EDGE_START_VERSION, TuiDestroyService, tuiIsEdgeOlderThan, tuiPure, TuiResizeService, } from '@taiga-ui/cdk';
import { BehaviorSubject, combineLatest } from 'rxjs';
import { distinctUntilChanged, map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "rxjs";
function calculateColorSegments(colors, progressWidth) {
    const segmentWidth = Math.ceil(progressWidth / colors.length);
    const colorsString = colors.reduce((acc, color, i) => `${acc}, ${color} ${i * segmentWidth}px ${(i + 1) * segmentWidth}px`, '');
    return `linear-gradient(to right ${colorsString})`;
}
export class TuiProgressColorSegmentsDirective {
    constructor(el, resize$, userAgent) {
        this.el = el;
        this.resize$ = resize$;
        this.userAgent = userAgent;
        // TODO: drop support of legacy Edge (EdgeHTML) in v4.x
        this.isOldBrowsers = tuiIsEdgeOlderThan(CHROMIUM_EDGE_START_VERSION, this.userAgent);
        this.colors$ = new BehaviorSubject([]);
    }
    set colors(colors) {
        this.colors$.next(colors);
    }
    get calcSegments$() {
        return combineLatest([
            this.colors$,
            this.resize$.pipe(map(() => this.el.nativeElement.offsetWidth), distinctUntilChanged()),
        ]).pipe(map(([colors, width]) => this.isOldBrowsers ? colors[0] : calculateColorSegments(colors, width)));
    }
}
TuiProgressColorSegmentsDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: TuiProgressColorSegmentsDirective, deps: [{ token: ElementRef }, { token: TuiResizeService }, { token: USER_AGENT }], target: i0.ɵɵFactoryTarget.Directive });
TuiProgressColorSegmentsDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "12.2.17", type: TuiProgressColorSegmentsDirective, selector: "progress[tuiProgressBar][tuiProgressColorSegments]", inputs: { colors: ["tuiProgressColorSegments", "colors"] }, host: { listeners: { "$.style.--tui-progress-color": "0" }, properties: { "$.style.--tui-progress-color": "calcSegments$" } }, providers: [TuiDestroyService, TuiResizeService], ngImport: i0 });
__decorate([
    tuiPure
], TuiProgressColorSegmentsDirective.prototype, "calcSegments$", null);
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: TuiProgressColorSegmentsDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'progress[tuiProgressBar][tuiProgressColorSegments]',
                    providers: [TuiDestroyService, TuiResizeService],
                    host: {
                        '[$.style.--tui-progress-color]': 'calcSegments$',
                        '($.style.--tui-progress-color)': '0',
                    },
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef, decorators: [{
                    type: Inject,
                    args: [ElementRef]
                }] }, { type: i1.Observable, decorators: [{
                    type: Inject,
                    args: [TuiResizeService]
                }] }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [USER_AGENT]
                }] }]; }, propDecorators: { colors: [{
                type: Input,
                args: ['tuiProgressColorSegments']
            }], calcSegments$: [] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZ3Jlc3MtY29sb3Itc2VnbWVudHMuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMva2l0L2NvbXBvbmVudHMvcHJvZ3Jlc3MvcHJvZ3Jlc3MtYmFyL3Byb2dyZXNzLWNvbG9yLXNlZ21lbnRzLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNuRSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFDL0MsT0FBTyxFQUNILDJCQUEyQixFQUMzQixpQkFBaUIsRUFDakIsa0JBQWtCLEVBQ2xCLE9BQU8sRUFDUCxnQkFBZ0IsR0FDbkIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLGVBQWUsRUFBRSxhQUFhLEVBQWEsTUFBTSxNQUFNLENBQUM7QUFDaEUsT0FBTyxFQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBQyxNQUFNLGdCQUFnQixDQUFDOzs7QUFFekQsU0FBUyxzQkFBc0IsQ0FBQyxNQUFnQixFQUFFLGFBQXFCO0lBQ25FLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM5RCxNQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsTUFBTSxDQUM5QixDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FDZCxHQUFHLEdBQUcsS0FBSyxLQUFLLElBQUksQ0FBQyxHQUFHLFlBQVksTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxZQUFZLElBQUksRUFDeEUsRUFBRSxDQUNMLENBQUM7SUFFRixPQUFPLDRCQUE0QixZQUFZLEdBQUcsQ0FBQztBQUN2RCxDQUFDO0FBVUQsTUFBTSxPQUFPLGlDQUFpQztJQTZCMUMsWUFDeUMsRUFBbUMsRUFDN0IsT0FBNEIsRUFDbEMsU0FBaUI7UUFGakIsT0FBRSxHQUFGLEVBQUUsQ0FBaUM7UUFDN0IsWUFBTyxHQUFQLE9BQU8sQ0FBcUI7UUFDbEMsY0FBUyxHQUFULFNBQVMsQ0FBUTtRQS9CMUQsdURBQXVEO1FBQ3RDLGtCQUFhLEdBQUcsa0JBQWtCLENBQy9DLDJCQUEyQixFQUMzQixJQUFJLENBQUMsU0FBUyxDQUNqQixDQUFDO1FBRWUsWUFBTyxHQUFHLElBQUksZUFBZSxDQUFXLEVBQUUsQ0FBQyxDQUFDO0lBMEIxRCxDQUFDO0lBeEJKLElBQ0ksTUFBTSxDQUFDLE1BQWdCO1FBQ3ZCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFHRCxJQUFJLGFBQWE7UUFDYixPQUFPLGFBQWEsQ0FBQztZQUNqQixJQUFJLENBQUMsT0FBTztZQUNaLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUNiLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsRUFDNUMsb0JBQW9CLEVBQUUsQ0FDekI7U0FDSixDQUFDLENBQUMsSUFBSSxDQUNILEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FDcEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQ3pFLENBQ0osQ0FBQztJQUNOLENBQUM7OytIQTNCUSxpQ0FBaUMsa0JBOEI5QixVQUFVLGFBQ1YsZ0JBQWdCLGFBQ2hCLFVBQVU7bUhBaENiLGlDQUFpQyx3UUFOL0IsQ0FBQyxpQkFBaUIsRUFBRSxnQkFBZ0IsQ0FBQztBQXFCaEQ7SUFEQyxPQUFPO3NFQWFQOzRGQTNCUSxpQ0FBaUM7a0JBUjdDLFNBQVM7bUJBQUM7b0JBQ1AsUUFBUSxFQUFFLG9EQUFvRDtvQkFDOUQsU0FBUyxFQUFFLENBQUMsaUJBQWlCLEVBQUUsZ0JBQWdCLENBQUM7b0JBQ2hELElBQUksRUFBRTt3QkFDRixnQ0FBZ0MsRUFBRSxlQUFlO3dCQUNqRCxnQ0FBZ0MsRUFBRSxHQUFHO3FCQUN4QztpQkFDSjs7MEJBK0JRLE1BQU07MkJBQUMsVUFBVTs7MEJBQ2pCLE1BQU07MkJBQUMsZ0JBQWdCOzswQkFDdkIsTUFBTTsyQkFBQyxVQUFVOzRDQXRCbEIsTUFBTTtzQkFEVCxLQUFLO3VCQUFDLDBCQUEwQjtnQkFNN0IsYUFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RGlyZWN0aXZlLCBFbGVtZW50UmVmLCBJbmplY3QsIElucHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7VVNFUl9BR0VOVH0gZnJvbSAnQG5nLXdlYi1hcGlzL2NvbW1vbic7XG5pbXBvcnQge1xuICAgIENIUk9NSVVNX0VER0VfU1RBUlRfVkVSU0lPTixcbiAgICBUdWlEZXN0cm95U2VydmljZSxcbiAgICB0dWlJc0VkZ2VPbGRlclRoYW4sXG4gICAgdHVpUHVyZSxcbiAgICBUdWlSZXNpemVTZXJ2aWNlLFxufSBmcm9tICdAdGFpZ2EtdWkvY2RrJztcbmltcG9ydCB7QmVoYXZpb3JTdWJqZWN0LCBjb21iaW5lTGF0ZXN0LCBPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcbmltcG9ydCB7ZGlzdGluY3RVbnRpbENoYW5nZWQsIG1hcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5mdW5jdGlvbiBjYWxjdWxhdGVDb2xvclNlZ21lbnRzKGNvbG9yczogc3RyaW5nW10sIHByb2dyZXNzV2lkdGg6IG51bWJlcik6IHN0cmluZyB7XG4gICAgY29uc3Qgc2VnbWVudFdpZHRoID0gTWF0aC5jZWlsKHByb2dyZXNzV2lkdGggLyBjb2xvcnMubGVuZ3RoKTtcbiAgICBjb25zdCBjb2xvcnNTdHJpbmcgPSBjb2xvcnMucmVkdWNlKFxuICAgICAgICAoYWNjLCBjb2xvciwgaSkgPT5cbiAgICAgICAgICAgIGAke2FjY30sICR7Y29sb3J9ICR7aSAqIHNlZ21lbnRXaWR0aH1weCAkeyhpICsgMSkgKiBzZWdtZW50V2lkdGh9cHhgLFxuICAgICAgICAnJyxcbiAgICApO1xuXG4gICAgcmV0dXJuIGBsaW5lYXItZ3JhZGllbnQodG8gcmlnaHQgJHtjb2xvcnNTdHJpbmd9KWA7XG59XG5cbkBEaXJlY3RpdmUoe1xuICAgIHNlbGVjdG9yOiAncHJvZ3Jlc3NbdHVpUHJvZ3Jlc3NCYXJdW3R1aVByb2dyZXNzQ29sb3JTZWdtZW50c10nLFxuICAgIHByb3ZpZGVyczogW1R1aURlc3Ryb3lTZXJ2aWNlLCBUdWlSZXNpemVTZXJ2aWNlXSxcbiAgICBob3N0OiB7XG4gICAgICAgICdbJC5zdHlsZS4tLXR1aS1wcm9ncmVzcy1jb2xvcl0nOiAnY2FsY1NlZ21lbnRzJCcsXG4gICAgICAgICcoJC5zdHlsZS4tLXR1aS1wcm9ncmVzcy1jb2xvciknOiAnMCcsXG4gICAgfSxcbn0pXG5leHBvcnQgY2xhc3MgVHVpUHJvZ3Jlc3NDb2xvclNlZ21lbnRzRGlyZWN0aXZlIHtcbiAgICAvLyBUT0RPOiBkcm9wIHN1cHBvcnQgb2YgbGVnYWN5IEVkZ2UgKEVkZ2VIVE1MKSBpbiB2NC54XG4gICAgcHJpdmF0ZSByZWFkb25seSBpc09sZEJyb3dzZXJzID0gdHVpSXNFZGdlT2xkZXJUaGFuKFxuICAgICAgICBDSFJPTUlVTV9FREdFX1NUQVJUX1ZFUlNJT04sXG4gICAgICAgIHRoaXMudXNlckFnZW50LFxuICAgICk7XG5cbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbG9ycyQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHN0cmluZ1tdPihbXSk7XG5cbiAgICBASW5wdXQoJ3R1aVByb2dyZXNzQ29sb3JTZWdtZW50cycpXG4gICAgc2V0IGNvbG9ycyhjb2xvcnM6IHN0cmluZ1tdKSB7XG4gICAgICAgIHRoaXMuY29sb3JzJC5uZXh0KGNvbG9ycyk7XG4gICAgfVxuXG4gICAgQHR1aVB1cmVcbiAgICBnZXQgY2FsY1NlZ21lbnRzJCgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xuICAgICAgICByZXR1cm4gY29tYmluZUxhdGVzdChbXG4gICAgICAgICAgICB0aGlzLmNvbG9ycyQsXG4gICAgICAgICAgICB0aGlzLnJlc2l6ZSQucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKCkgPT4gdGhpcy5lbC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoKSxcbiAgICAgICAgICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgXSkucGlwZShcbiAgICAgICAgICAgIG1hcCgoW2NvbG9ycywgd2lkdGhdKSA9PlxuICAgICAgICAgICAgICAgIHRoaXMuaXNPbGRCcm93c2VycyA/IGNvbG9yc1swXSA6IGNhbGN1bGF0ZUNvbG9yU2VnbWVudHMoY29sb3JzLCB3aWR0aCksXG4gICAgICAgICAgICApLFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBASW5qZWN0KEVsZW1lbnRSZWYpIHByaXZhdGUgcmVhZG9ubHkgZWw6IEVsZW1lbnRSZWY8SFRNTFByb2dyZXNzRWxlbWVudD4sXG4gICAgICAgIEBJbmplY3QoVHVpUmVzaXplU2VydmljZSkgcHJpdmF0ZSByZWFkb25seSByZXNpemUkOiBPYnNlcnZhYmxlPHVua25vd24+LFxuICAgICAgICBASW5qZWN0KFVTRVJfQUdFTlQpIHByaXZhdGUgcmVhZG9ubHkgdXNlckFnZW50OiBzdHJpbmcsXG4gICAgKSB7fVxufVxuIl19