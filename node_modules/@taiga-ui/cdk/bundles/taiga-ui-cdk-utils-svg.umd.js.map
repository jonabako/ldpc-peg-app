{"version":3,"file":"taiga-ui-cdk-utils-svg.umd.js","sources":["../../../projects/cdk/utils/svg/svg-linear-gradient-processor.ts","../../../projects/cdk/utils/svg/taiga-ui-cdk-utils-svg.ts"],"sourcesContent":["import {TuiSafeHtml} from '@taiga-ui/cdk/interfaces';\nimport {tuiIsString} from '@taiga-ui/cdk/utils/miscellaneous';\n\nfunction makeRandomSalt(): number {\n    return Math.floor(Math.random() * Date.now());\n}\n\nfunction escapeRegExp(search: string): string {\n    return search.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&');\n}\n\nfunction extractLinearGradientIdsFromSvg(svg: string): string[] {\n    const ids = (svg.match(/url\\((\"?)('*)#(.*?)('*)\\)/g) ?? []).map(url =>\n        url.slice(4, url.length - 1).replace(/['\"#]+/g, ''),\n    );\n\n    return Array.from(new Set(ids));\n}\n\n/**\n * TODO: remove in v4.0\n * @deprecated\n */\nfunction setFallbackForGradientFill(svg: string, fallback: string): string {\n    try {\n        const tree = new DOMParser().parseFromString(svg, 'text/html');\n\n        tree.body\n            .querySelectorAll('[fill^=url]') // only gradient\n            .forEach(element =>\n                element.setAttribute(\n                    'fill',\n                    `${element.getAttribute('fill')} ${fallback}`.trim(),\n                ),\n            );\n\n        return tree.body.innerHTML.trim();\n    } catch {\n        return svg;\n    }\n}\n\n/**\n * @description:\n * Any ‘linearGradient’ attributes which are defined on the referenced\n * element which are not defined on this element are inherited by this element.\n * If this element has no defined gradient stops, and the referenced element does\n * (possibly due to its own ‘xlink:href’ attribute), then this element inherits\n * the gradient stop from the referenced element. Inheritance can be indirect\n * to an arbitrary level; thus, if the referenced element inherits attribute\n * or gradient stops due to its own ‘xlink:href’ attribute, then the current\n * element can inherit those attributes or gradient stops.\n *\n * Documentation: https://www.w3.org/TR/SVG11/pservers.html\n *\n */\nexport function tuiSvgLinearGradientProcessor(\n    svg: TuiSafeHtml,\n    salt: number | string = makeRandomSalt(),\n    /**\n     * TODO: remove in v4.0\n     * @deprecated\n     */\n    fallback: string = 'rgba(0, 0, 0, 0.7)',\n): TuiSafeHtml {\n    if (tuiIsString(svg)) {\n        const uniqueIds = extractLinearGradientIdsFromSvg(svg);\n        const rawSvg = uniqueIds.reduce((newSvg, previousId) => {\n            const escapedId = escapeRegExp(previousId);\n            const newId = `id_${salt}_${previousId}`;\n\n            return newSvg\n                .replace(new RegExp(`\"${escapedId}\"`, 'g'), `\"${newId}\"`)\n                .replace(new RegExp(`'${escapedId}'`, 'g'), `'${newId}'`)\n                .replace(new RegExp(`url\\\\('#${escapedId}'\\\\)`, 'g'), `url('#${newId}')`)\n                .replace(new RegExp(`url\\\\(\"#${escapedId}\"\\\\)`, 'g'), `url(\"#${newId}\")`)\n                .replace(new RegExp(`url\\\\(#${escapedId}\\\\)`, 'g'), `url(#${newId})`);\n        }, svg);\n\n        return setFallbackForGradientFill(rawSvg, fallback);\n    }\n\n    return svg;\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["tuiIsString"],"mappings":"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"}