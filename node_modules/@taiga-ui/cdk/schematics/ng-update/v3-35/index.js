"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateToV3_35 = void 0;
const ng_morph_1 = require("ng-morph");
const colored_log_1 = require("../../utils/colored-log");
const replace_imports_1 = require("../steps/icons/replace-imports");
const get_file_system_1 = require("../utils/get-file-system");
const replace_text_1 = require("../utils/replace-text");
const constants_1 = require("./constants/constants");
const icons_1 = require("./constants/icons");
function hasProprietaryIcons(tree) {
    return !!ng_morph_1.getPackageJsonDependency(tree, '@taiga-ui/proprietary-icons');
}
function updateToV3_35(options) {
    return (tree, _) => {
        if (!hasProprietaryIcons(tree)) {
            !options['skip-logs'] &&
                colored_log_1.titleLog(`${colored_log_1.FINISH_SYMBOL} No migrations required\n`);
            return;
        }
        const fileSystem = get_file_system_1.getFileSystem(tree);
        replace_imports_1.replaceImports(constants_1.ICONS_TS, options);
        !options['skip-logs'] &&
            colored_log_1.infoLog(`${colored_log_1.SMALL_TAB_SYMBOL}${colored_log_1.REPLACE_SYMBOL} replacing strings...`);
        replace_text_1.replaceText(icons_1.ICONS.map(({ from, to }) => ({ from: new RegExp(`\\b${from}\\b`, 'g'), to })));
        fileSystem.commitEdits();
        ng_morph_1.saveActiveProject();
        !options['skip-logs'] &&
            colored_log_1.titleLog(`${colored_log_1.FINISH_SYMBOL} Icons successfully migrated \n`);
    };
}
exports.updateToV3_35 = updateToV3_35;
