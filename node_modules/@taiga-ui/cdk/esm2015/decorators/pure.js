import { TuiPureException } from '@taiga-ui/cdk/exceptions';
function decorateMethod(originalMethod) {
    let previousArgs = [];
    let originalFnWasCalledLeastAtOnce = false;
    let pureValue;
    return function tuiPureMethodPatched(...args) {
        const isPure = originalFnWasCalledLeastAtOnce &&
            previousArgs.length === args.length &&
            args.every((arg, index) => arg === previousArgs[index]);
        if (isPure) {
            return pureValue;
        }
        previousArgs = args;
        pureValue = originalMethod.apply(this, args);
        originalFnWasCalledLeastAtOnce = true;
        return pureValue;
    };
}
function decorateGetter(originalGetter, propertyKey, enumerable = true) {
    return function tuiPureGetterPatched() {
        const value = originalGetter.call(this);
        Object.defineProperty(this, propertyKey, { enumerable, value });
        return value;
    };
}
export function tuiPure(target, propertyKeyOrContext, descriptor) {
    if (typeof target === 'function') {
        const context = propertyKeyOrContext;
        if (context.kind === 'getter') {
            return decorateGetter(target, context.name);
        }
        if (context.kind === 'method') {
            return decorateMethod(target);
        }
        throw new TuiPureException();
    }
    const { get, enumerable, value } = descriptor;
    const propertyKey = propertyKeyOrContext;
    if (get) {
        return {
            configurable: true,
            enumerable,
            get: decorateGetter(get, propertyKey, enumerable),
        };
    }
    if (typeof value !== 'function') {
        throw new TuiPureException();
    }
    const original = value;
    return {
        configurable: true,
        enumerable,
        get() {
            let previousArgs = [];
            let originalFnWasCalledLeastAtOnce = false;
            let pureValue;
            const patched = (...args) => {
                const isPure = originalFnWasCalledLeastAtOnce &&
                    previousArgs.length === args.length &&
                    args.every((arg, index) => arg === previousArgs[index]);
                if (isPure) {
                    return pureValue;
                }
                previousArgs = args;
                pureValue = original.apply(this, args);
                originalFnWasCalledLeastAtOnce = true;
                return pureValue;
            };
            Object.defineProperty(this, propertyKey, {
                configurable: true,
                value: patched,
            });
            return patched;
        },
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVyZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL2Nkay9kZWNvcmF0b3JzL3B1cmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFjMUQsU0FBUyxjQUFjLENBQ25CLGNBQStDO0lBRS9DLElBQUksWUFBWSxHQUF1QixFQUFFLENBQUM7SUFDMUMsSUFBSSw4QkFBOEIsR0FBRyxLQUFLLENBQUM7SUFDM0MsSUFBSSxTQUFrQixDQUFDO0lBRXZCLE9BQU8sU0FBUyxvQkFBb0IsQ0FBZSxHQUFHLElBQWU7UUFDakUsTUFBTSxNQUFNLEdBQ1IsOEJBQThCO1lBQzlCLFlBQVksQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLE1BQU07WUFDbkMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLEdBQUcsS0FBSyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUU1RCxJQUFJLE1BQU0sRUFBRTtZQUNSLE9BQU8sU0FBUyxDQUFDO1NBQ3BCO1FBRUQsWUFBWSxHQUFHLElBQUksQ0FBQztRQUNwQixTQUFTLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDN0MsOEJBQThCLEdBQUcsSUFBSSxDQUFDO1FBRXRDLE9BQU8sU0FBUyxDQUFDO0lBQ3JCLENBQUMsQ0FBQztBQUNOLENBQUM7QUFFRCxTQUFTLGNBQWMsQ0FDbkIsY0FBNkIsRUFDN0IsV0FBNEIsRUFDNUIsYUFBc0IsSUFBSTtJQUUxQixPQUFPLFNBQVMsb0JBQW9CO1FBQ2hDLE1BQU0sS0FBSyxHQUFHLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFeEMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsV0FBVyxFQUFFLEVBQUMsVUFBVSxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7UUFFOUQsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQyxDQUFDO0FBQ04sQ0FBQztBQTZCRCxNQUFNLFVBQVUsT0FBTyxDQUNuQixNQUFrRCxFQUNsRCxvQkFHWSxFQUNaLFVBQXFFO0lBRXJFLElBQUksT0FBTyxNQUFNLEtBQUssVUFBVSxFQUFFO1FBQzlCLE1BQU0sT0FBTyxHQUFHLG9CQUVpQixDQUFDO1FBRWxDLElBQUksT0FBTyxDQUFDLElBQUksS0FBSyxRQUFRLEVBQUU7WUFDM0IsT0FBTyxjQUFjLENBQUMsTUFBdUIsRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDaEU7UUFFRCxJQUFJLE9BQU8sQ0FBQyxJQUFJLEtBQUssUUFBUSxFQUFFO1lBQzNCLE9BQU8sY0FBYyxDQUFDLE1BQXlDLENBQUMsQ0FBQztTQUNwRTtRQUVELE1BQU0sSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO0tBQ2hDO0lBRUQsTUFBTSxFQUFDLEdBQUcsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFDLEdBQUcsVUFBVyxDQUFDO0lBQzdDLE1BQU0sV0FBVyxHQUFHLG9CQUE4QixDQUFDO0lBRW5ELElBQUksR0FBRyxFQUFFO1FBQ0wsT0FBTztZQUNILFlBQVksRUFBRSxJQUFJO1lBQ2xCLFVBQVU7WUFDVixHQUFHLEVBQUUsY0FBYyxDQUFDLEdBQUcsRUFBRSxXQUFXLEVBQUUsVUFBVSxDQUFDO1NBQ3BELENBQUM7S0FDTDtJQUVELElBQUksT0FBTyxLQUFLLEtBQUssVUFBVSxFQUFFO1FBQzdCLE1BQU0sSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO0tBQ2hDO0lBRUQsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDO0lBRXZCLE9BQU87UUFDSCxZQUFZLEVBQUUsSUFBSTtRQUNsQixVQUFVO1FBQ1YsR0FBRztZQUNDLElBQUksWUFBWSxHQUF1QixFQUFFLENBQUM7WUFDMUMsSUFBSSw4QkFBOEIsR0FBRyxLQUFLLENBQUM7WUFDM0MsSUFBSSxTQUFrQixDQUFDO1lBRXZCLE1BQU0sT0FBTyxHQUFHLENBQUMsR0FBRyxJQUFlLEVBQVcsRUFBRTtnQkFDNUMsTUFBTSxNQUFNLEdBQ1IsOEJBQThCO29CQUM5QixZQUFZLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNO29CQUNuQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsR0FBRyxLQUFLLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUU1RCxJQUFJLE1BQU0sRUFBRTtvQkFDUixPQUFPLFNBQVMsQ0FBQztpQkFDcEI7Z0JBRUQsWUFBWSxHQUFHLElBQUksQ0FBQztnQkFDcEIsU0FBUyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUN2Qyw4QkFBOEIsR0FBRyxJQUFJLENBQUM7Z0JBRXRDLE9BQU8sU0FBUyxDQUFDO1lBQ3JCLENBQUMsQ0FBQztZQUVGLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLFdBQVcsRUFBRTtnQkFDckMsWUFBWSxFQUFFLElBQUk7Z0JBQ2xCLEtBQUssRUFBRSxPQUFPO2FBQ2pCLENBQUMsQ0FBQztZQUVILE9BQU8sT0FBa0IsQ0FBQztRQUM5QixDQUFDO0tBQ0osQ0FBQztBQUNOLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1R1aVB1cmVFeGNlcHRpb259IGZyb20gJ0B0YWlnYS11aS9jZGsvZXhjZXB0aW9ucyc7XG5cbi8qKiBUT0RPIERlbGV0ZSBhZnRlciB1cGRhdGluZyB0eXBlc2NyaXB0IHRvIHZlcnNpb24gNSBhbmQgd2hlbiBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IHdpbGwgbm90IGJlIHJlcXVpcmVkICovXG5pbnRlcmZhY2UgQ2xhc3NHZXR0ZXJEZWNvcmF0b3JDb250ZXh0IHtcbiAgICBraW5kOiAnZ2V0dGVyJztcbiAgICBuYW1lOiBzdHJpbmc7XG59XG5cbi8qKiBUT0RPIERlbGV0ZSBhZnRlciB1cGRhdGluZyB0eXBlc2NyaXB0IHRvIHZlcnNpb24gNSBhbmQgd2hlbiBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IHdpbGwgbm90IGJlIHJlcXVpcmVkICovXG5pbnRlcmZhY2UgQ2xhc3NNZXRob2REZWNvcmF0b3JDb250ZXh0IHtcbiAgICBraW5kOiAnbWV0aG9kJztcbiAgICBuYW1lOiBzdHJpbmc7XG59XG5cbmZ1bmN0aW9uIGRlY29yYXRlTWV0aG9kKFxuICAgIG9yaWdpbmFsTWV0aG9kOiAoLi4uYXJnczogdW5rbm93bltdKSA9PiB1bmtub3duLFxuKTogKHRoaXM6IG9iamVjdCwgLi4uYXJnczogdW5rbm93bltdKSA9PiB1bmtub3duIHtcbiAgICBsZXQgcHJldmlvdXNBcmdzOiByZWFkb25seSB1bmtub3duW10gPSBbXTtcbiAgICBsZXQgb3JpZ2luYWxGbldhc0NhbGxlZExlYXN0QXRPbmNlID0gZmFsc2U7XG4gICAgbGV0IHB1cmVWYWx1ZTogdW5rbm93bjtcblxuICAgIHJldHVybiBmdW5jdGlvbiB0dWlQdXJlTWV0aG9kUGF0Y2hlZCh0aGlzOiBvYmplY3QsIC4uLmFyZ3M6IHVua25vd25bXSk6IHVua25vd24ge1xuICAgICAgICBjb25zdCBpc1B1cmUgPVxuICAgICAgICAgICAgb3JpZ2luYWxGbldhc0NhbGxlZExlYXN0QXRPbmNlICYmXG4gICAgICAgICAgICBwcmV2aW91c0FyZ3MubGVuZ3RoID09PSBhcmdzLmxlbmd0aCAmJlxuICAgICAgICAgICAgYXJncy5ldmVyeSgoYXJnLCBpbmRleCkgPT4gYXJnID09PSBwcmV2aW91c0FyZ3NbaW5kZXhdKTtcblxuICAgICAgICBpZiAoaXNQdXJlKSB7XG4gICAgICAgICAgICByZXR1cm4gcHVyZVZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcHJldmlvdXNBcmdzID0gYXJncztcbiAgICAgICAgcHVyZVZhbHVlID0gb3JpZ2luYWxNZXRob2QuYXBwbHkodGhpcywgYXJncyk7XG4gICAgICAgIG9yaWdpbmFsRm5XYXNDYWxsZWRMZWFzdEF0T25jZSA9IHRydWU7XG5cbiAgICAgICAgcmV0dXJuIHB1cmVWYWx1ZTtcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBkZWNvcmF0ZUdldHRlcihcbiAgICBvcmlnaW5hbEdldHRlcjogKCkgPT4gdW5rbm93bixcbiAgICBwcm9wZXJ0eUtleTogc3RyaW5nIHwgc3ltYm9sLFxuICAgIGVudW1lcmFibGU6IGJvb2xlYW4gPSB0cnVlLFxuKTogKHRoaXM6IG9iamVjdCkgPT4gdW5rbm93biB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHR1aVB1cmVHZXR0ZXJQYXRjaGVkKHRoaXM6IG9iamVjdCk6IHVua25vd24ge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IG9yaWdpbmFsR2V0dGVyLmNhbGwodGhpcyk7XG5cbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIHByb3BlcnR5S2V5LCB7ZW51bWVyYWJsZSwgdmFsdWV9KTtcblxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfTtcbn1cblxuLyoqXG4gKiBJbXBsZW1lbnRzIGxhenkgaW5pdGlhbGl6YXRpb24gZm9yIGdldHRlciBvciBtZW1vaXphdGlvbiBvZiBhIGZ1bmN0aW9uIGNhbGwgc2ltaWxhciB0byBwdXJlIHtAbGluazogUGlwZX0uXG4gKiBSZXBsYWNlcyBnZXR0ZXIgd2l0aCBpdHMgY2FsY3VsYXRlZCB2YWx1ZSB1cG9uIGZpcnN0IGNhbGwgb3Iga2VlcHMgdHJhY2sgb2YgbGFzdCBjYWxsIGFyZ3VtZW50cyBhbmQgcmV0dXJuZWRcbiAqIHZhbHVlIGZvciBmdW5jdGlvbiwgc2tpcHBpbmcgY2FsY3VsYXRpb24gd2hlbiBhcmd1bWVudHMgYXJlIHN0cmljdGx5IHRoZSBzYW1lLlxuICpcbiAqIEB0aHJvd3MgZXJyb3IgaWYgdXNlZCBub3Qgb24gZ2V0dGVyIG9yIGZ1bmN0aW9uXG4gKlxuICogQ0FVVElPTjogdGhleSBtdXN0IGJlIHB1cmUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0dWlQdXJlPFQ+KFxuICAgIHRhcmdldDogb2JqZWN0LFxuICAgIHByb3BlcnR5S2V5OiBzdHJpbmcsXG4gICAge2dldCwgZW51bWVyYWJsZSwgdmFsdWV9OiBUeXBlZFByb3BlcnR5RGVzY3JpcHRvcjxUPixcbik6IFR5cGVkUHJvcGVydHlEZXNjcmlwdG9yPFQ+O1xuXG4vKipcbiAqIEltcGxlbWVudHMgbGF6eSBpbml0aWFsaXphdGlvbiBmb3IgZ2V0dGVyIG9yIG1lbW9pemF0aW9uIG9mIGEgZnVuY3Rpb24gY2FsbCBzaW1pbGFyIHRvIHB1cmUge0BsaW5rOiBQaXBlfS5cbiAqIFJlcGxhY2VzIGdldHRlciB3aXRoIGl0cyBjYWxjdWxhdGVkIHZhbHVlIHVwb24gZmlyc3QgY2FsbCBvciBrZWVwcyB0cmFjayBvZiBsYXN0IGNhbGwgYXJndW1lbnRzIGFuZCByZXR1cm5lZFxuICogdmFsdWUgZm9yIGZ1bmN0aW9uLCBza2lwcGluZyBjYWxjdWxhdGlvbiB3aGVuIGFyZ3VtZW50cyBhcmUgc3RyaWN0bHkgdGhlIHNhbWUuXG4gKlxuICogQ0FVVElPTjogdGhleSBtdXN0IGJlIHB1cmUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0dWlQdXJlPEEgZXh0ZW5kcyB1bmtub3duW10sIFI+KFxuICAgIHRhcmdldDogKC4uLmFyZ3M6IEEpID0+IFIsXG4gICAgY29udGV4dDogQ2xhc3NHZXR0ZXJEZWNvcmF0b3JDb250ZXh0IHwgQ2xhc3NNZXRob2REZWNvcmF0b3JDb250ZXh0LFxuKTogKC4uLmFyZ3M6IEEpID0+IFI7XG5cbmV4cG9ydCBmdW5jdGlvbiB0dWlQdXJlKFxuICAgIHRhcmdldDogb2JqZWN0IHwgKCguLi5hcmdzOiB1bmtub3duW10pID0+IHVua25vd24pLFxuICAgIHByb3BlcnR5S2V5T3JDb250ZXh0OlxuICAgICAgICB8IENsYXNzR2V0dGVyRGVjb3JhdG9yQ29udGV4dFxuICAgICAgICB8IENsYXNzTWV0aG9kRGVjb3JhdG9yQ29udGV4dFxuICAgICAgICB8IHN0cmluZyxcbiAgICBkZXNjcmlwdG9yPzogVHlwZWRQcm9wZXJ0eURlc2NyaXB0b3I8KC4uLmFyZ3M6IHVua25vd25bXSkgPT4gdW5rbm93bj4sXG4pOiBUeXBlZFByb3BlcnR5RGVzY3JpcHRvcjx1bmtub3duPiB8ICgoLi4uYXJnczogdW5rbm93bltdKSA9PiB1bmtub3duKSB7XG4gICAgaWYgKHR5cGVvZiB0YXJnZXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IHByb3BlcnR5S2V5T3JDb250ZXh0IGFzXG4gICAgICAgICAgICB8IENsYXNzR2V0dGVyRGVjb3JhdG9yQ29udGV4dFxuICAgICAgICAgICAgfCBDbGFzc01ldGhvZERlY29yYXRvckNvbnRleHQ7XG5cbiAgICAgICAgaWYgKGNvbnRleHQua2luZCA9PT0gJ2dldHRlcicpIHtcbiAgICAgICAgICAgIHJldHVybiBkZWNvcmF0ZUdldHRlcih0YXJnZXQgYXMgKCkgPT4gdW5rbm93biwgY29udGV4dC5uYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb250ZXh0LmtpbmQgPT09ICdtZXRob2QnKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVjb3JhdGVNZXRob2QodGFyZ2V0IGFzICguLi5hcmdzOiB1bmtub3duW10pID0+IHVua25vd24pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgbmV3IFR1aVB1cmVFeGNlcHRpb24oKTtcbiAgICB9XG5cbiAgICBjb25zdCB7Z2V0LCBlbnVtZXJhYmxlLCB2YWx1ZX0gPSBkZXNjcmlwdG9yITtcbiAgICBjb25zdCBwcm9wZXJ0eUtleSA9IHByb3BlcnR5S2V5T3JDb250ZXh0IGFzIHN0cmluZztcblxuICAgIGlmIChnZXQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGVudW1lcmFibGUsXG4gICAgICAgICAgICBnZXQ6IGRlY29yYXRlR2V0dGVyKGdldCwgcHJvcGVydHlLZXksIGVudW1lcmFibGUpLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR1aVB1cmVFeGNlcHRpb24oKTtcbiAgICB9XG5cbiAgICBjb25zdCBvcmlnaW5hbCA9IHZhbHVlO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICBlbnVtZXJhYmxlLFxuICAgICAgICBnZXQoKTogdW5rbm93biB7XG4gICAgICAgICAgICBsZXQgcHJldmlvdXNBcmdzOiByZWFkb25seSB1bmtub3duW10gPSBbXTtcbiAgICAgICAgICAgIGxldCBvcmlnaW5hbEZuV2FzQ2FsbGVkTGVhc3RBdE9uY2UgPSBmYWxzZTtcbiAgICAgICAgICAgIGxldCBwdXJlVmFsdWU6IHVua25vd247XG5cbiAgICAgICAgICAgIGNvbnN0IHBhdGNoZWQgPSAoLi4uYXJnczogdW5rbm93bltdKTogdW5rbm93biA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNQdXJlID1cbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxGbldhc0NhbGxlZExlYXN0QXRPbmNlICYmXG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzQXJncy5sZW5ndGggPT09IGFyZ3MubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgIGFyZ3MuZXZlcnkoKGFyZywgaW5kZXgpID0+IGFyZyA9PT0gcHJldmlvdXNBcmdzW2luZGV4XSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNQdXJlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwdXJlVmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcHJldmlvdXNBcmdzID0gYXJncztcbiAgICAgICAgICAgICAgICBwdXJlVmFsdWUgPSBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICAgICAgICBvcmlnaW5hbEZuV2FzQ2FsbGVkTGVhc3RBdE9uY2UgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHB1cmVWYWx1ZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBwcm9wZXJ0eUtleSwge1xuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogcGF0Y2hlZCxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcGF0Y2hlZCBhcyB1bmtub3duO1xuICAgICAgICB9LFxuICAgIH07XG59XG4iXX0=