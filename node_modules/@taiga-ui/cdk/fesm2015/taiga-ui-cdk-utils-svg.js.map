{"version":3,"file":"taiga-ui-cdk-utils-svg.js","sources":["../../../projects/cdk/utils/svg/svg-linear-gradient-processor.ts","../../../projects/cdk/utils/svg/taiga-ui-cdk-utils-svg.ts"],"sourcesContent":["import {TuiSafeHtml} from '@taiga-ui/cdk/interfaces';\nimport {tuiIsString} from '@taiga-ui/cdk/utils/miscellaneous';\n\nfunction makeRandomSalt(): number {\n    return Math.floor(Math.random() * Date.now());\n}\n\nfunction escapeRegExp(search: string): string {\n    return search.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&');\n}\n\nfunction extractLinearGradientIdsFromSvg(svg: string): string[] {\n    const ids = (svg.match(/url\\((\"?)('*)#(.*?)('*)\\)/g) ?? []).map(url =>\n        url.slice(4, url.length - 1).replace(/['\"#]+/g, ''),\n    );\n\n    return Array.from(new Set(ids));\n}\n\n/**\n * TODO: remove in v4.0\n * @deprecated\n */\nfunction setFallbackForGradientFill(svg: string, fallback: string): string {\n    try {\n        const tree = new DOMParser().parseFromString(svg, 'text/html');\n\n        tree.body\n            .querySelectorAll('[fill^=url]') // only gradient\n            .forEach(element =>\n                element.setAttribute(\n                    'fill',\n                    `${element.getAttribute('fill')} ${fallback}`.trim(),\n                ),\n            );\n\n        return tree.body.innerHTML.trim();\n    } catch {\n        return svg;\n    }\n}\n\n/**\n * @description:\n * Any ‘linearGradient’ attributes which are defined on the referenced\n * element which are not defined on this element are inherited by this element.\n * If this element has no defined gradient stops, and the referenced element does\n * (possibly due to its own ‘xlink:href’ attribute), then this element inherits\n * the gradient stop from the referenced element. Inheritance can be indirect\n * to an arbitrary level; thus, if the referenced element inherits attribute\n * or gradient stops due to its own ‘xlink:href’ attribute, then the current\n * element can inherit those attributes or gradient stops.\n *\n * Documentation: https://www.w3.org/TR/SVG11/pservers.html\n *\n */\nexport function tuiSvgLinearGradientProcessor(\n    svg: TuiSafeHtml,\n    salt: number | string = makeRandomSalt(),\n    /**\n     * TODO: remove in v4.0\n     * @deprecated\n     */\n    fallback: string = 'rgba(0, 0, 0, 0.7)',\n): TuiSafeHtml {\n    if (tuiIsString(svg)) {\n        const uniqueIds = extractLinearGradientIdsFromSvg(svg);\n        const rawSvg = uniqueIds.reduce((newSvg, previousId) => {\n            const escapedId = escapeRegExp(previousId);\n            const newId = `id_${salt}_${previousId}`;\n\n            return newSvg\n                .replace(new RegExp(`\"${escapedId}\"`, 'g'), `\"${newId}\"`)\n                .replace(new RegExp(`'${escapedId}'`, 'g'), `'${newId}'`)\n                .replace(new RegExp(`url\\\\('#${escapedId}'\\\\)`, 'g'), `url('#${newId}')`)\n                .replace(new RegExp(`url\\\\(\"#${escapedId}\"\\\\)`, 'g'), `url(\"#${newId}\")`)\n                .replace(new RegExp(`url\\\\(#${escapedId}\\\\)`, 'g'), `url(#${newId})`);\n        }, svg);\n\n        return setFallbackForGradientFill(rawSvg, fallback);\n    }\n\n    return svg;\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}