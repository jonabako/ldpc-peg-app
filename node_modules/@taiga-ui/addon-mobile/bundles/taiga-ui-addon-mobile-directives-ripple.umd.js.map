{"version":3,"file":"taiga-ui-addon-mobile-directives-ripple.umd.js","sources":["../../../projects/addon-mobile/directives/ripple/ripple.providers.ts","../../../projects/addon-mobile/directives/ripple/ripple-styles.component.ts","../../../projects/addon-mobile/directives/ripple/ripple.directive.ts","../../../projects/addon-mobile/directives/ripple/ripple.module.ts","../../../projects/addon-mobile/directives/ripple/taiga-ui-addon-mobile-directives-ripple.ts"],"sourcesContent":["import {ElementRef, InjectionToken, Provider, Renderer2} from '@angular/core';\nimport {\n    TUI_IS_IOS,\n    TUI_TOUCH_SUPPORTED,\n    TuiDestroyService,\n    tuiIsPresent,\n    tuiPx,\n    tuiTypedFromEvent,\n} from '@taiga-ui/cdk';\nimport {EMPTY, Observable} from 'rxjs';\nimport {filter, map, takeUntil} from 'rxjs/operators';\n\nexport const RIPPLE_ON = 'tuiRippleOn';\nexport const RIPPLE_OFF = 'tuiRippleOff';\n\n/**\n * Stream of ripple elements to add\n */\nexport const TUI_RIPPLE_START = new InjectionToken<Observable<HTMLElement>>(\n    '[TUI_RIPPLE_START]',\n);\n\n/**\n * Stream of ripple elements to remove\n */\nexport const TUI_RIPPLE_END = new InjectionToken<Observable<HTMLElement>>(\n    '[TUI_RIPPLE_END]',\n);\n\nexport const TUI_RIPPLE_PROVIDERS: Provider[] = [\n    TuiDestroyService,\n    {\n        provide: TUI_RIPPLE_START,\n        deps: [TUI_TOUCH_SUPPORTED, TUI_IS_IOS, ElementRef, Renderer2],\n        useFactory: (\n            touchSupported: boolean,\n            isIOS: boolean,\n            {nativeElement}: ElementRef<HTMLElement>,\n            renderer: Renderer2,\n        ): Observable<HTMLElement> =>\n            isIOS || !touchSupported\n                ? EMPTY\n                : tuiTypedFromEvent(nativeElement, 'touchstart').pipe(\n                      map(({touches}) => {\n                          const {clientX, clientY} = touches[touches.length - 1];\n                          const {width, height, top, left} =\n                              nativeElement.getBoundingClientRect();\n                          const radius = Math.sqrt(width * width + height * height);\n                          const dimension = radius * 2;\n                          const x = clientX - left - radius;\n                          const y = clientY - top - radius;\n                          const ripple = renderer.createElement('div');\n\n                          renderer.addClass(ripple, 'tui-ripple');\n                          renderer.setAttribute(\n                              ripple,\n                              'style',\n                              `width: ${tuiPx(dimension)}; height: ${tuiPx(\n                                  dimension,\n                              )}; left: ${tuiPx(x)}; top: ${tuiPx(\n                                  y,\n                              )}; animation-name: ${RIPPLE_ON};`,\n                          );\n\n                          return ripple;\n                      }),\n                  ),\n    },\n    {\n        provide: TUI_RIPPLE_END,\n        deps: [TUI_TOUCH_SUPPORTED, TUI_IS_IOS, ElementRef, TuiDestroyService],\n        useFactory: (\n            touchSupported: boolean,\n            isIOS: boolean,\n            {nativeElement}: ElementRef<HTMLElement>,\n            destroy$: Observable<void>,\n        ): Observable<EventTarget> =>\n            isIOS || !touchSupported\n                ? EMPTY\n                : tuiTypedFromEvent(nativeElement, 'animationend').pipe(\n                      filter(({animationName}) => animationName === RIPPLE_OFF),\n                      map(({target}) => target),\n                      filter(tuiIsPresent),\n                      takeUntil(destroy$),\n                  ),\n    },\n];\n","import {ChangeDetectionStrategy, Component, ViewEncapsulation} from '@angular/core';\n\n@Component({\n    host: {\n        class: 'tui-ripple-styles',\n    },\n    template: '',\n    styleUrls: ['./ripple.style.less'],\n    encapsulation: ViewEncapsulation.None,\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TuiRippleStylesComponent {}\n","import {Directive, ElementRef, Inject, Input, Renderer2, Self} from '@angular/core';\nimport {\n    ALWAYS_FALSE_HANDLER,\n    ALWAYS_TRUE_HANDLER,\n    TuiDestroyService,\n    TuiDirectiveStylesService,\n    tuiTypedFromEvent,\n} from '@taiga-ui/cdk';\nimport {Observable, race, timer} from 'rxjs';\nimport {map, mergeMap, switchMap, take, takeUntil, tap} from 'rxjs/operators';\n\nimport {\n    RIPPLE_OFF,\n    TUI_RIPPLE_END,\n    TUI_RIPPLE_PROVIDERS,\n    TUI_RIPPLE_START,\n} from './ripple.providers';\nimport {TuiRippleStylesComponent} from './ripple-styles.component';\n\nconst TOUCH_MOVE_DELAY = 100;\n\n@Directive({\n    selector: '[tuiRipple]',\n    providers: TUI_RIPPLE_PROVIDERS,\n})\nexport class TuiRippleDirective {\n    @Input()\n    tuiRipple?: string | '';\n\n    constructor(\n        @Inject(ElementRef) {nativeElement}: ElementRef<HTMLElement>,\n        @Inject(TuiDirectiveStylesService) directiveStyles: TuiDirectiveStylesService,\n        @Inject(Renderer2) renderer: Renderer2,\n        @Self() @Inject(TuiDestroyService) destroy$: TuiDestroyService,\n        @Inject(TUI_RIPPLE_START) start$: Observable<HTMLElement>,\n        @Inject(TUI_RIPPLE_END) end$: Observable<EventTarget>,\n    ) {\n        directiveStyles.addComponent(TuiRippleStylesComponent);\n\n        const touchEnd$ = tuiTypedFromEvent(nativeElement, 'touchend');\n        const touchMove$ = tuiTypedFromEvent(nativeElement, 'touchmove');\n\n        end$.subscribe(element => {\n            renderer.removeChild(nativeElement, element);\n        });\n        start$\n            .pipe(\n                mergeMap(ripple => {\n                    const animationEndOn$ = tuiTypedFromEvent(ripple, 'animationend');\n\n                    return race(\n                        timer(TOUCH_MOVE_DELAY).pipe(map(ALWAYS_FALSE_HANDLER)),\n                        touchEnd$.pipe(map(ALWAYS_TRUE_HANDLER)),\n                    ).pipe(\n                        take(1),\n                        // eslint-disable-next-line rxjs/no-unsafe-takeuntil\n                        takeUntil(touchMove$),\n                        tap(() => {\n                            renderer.setStyle(\n                                ripple,\n                                'background',\n                                this.tuiRipple || null,\n                            );\n                            renderer.appendChild(nativeElement, ripple);\n                        }),\n                        switchMap(isTap =>\n                            isTap\n                                ? animationEndOn$\n                                : race(\n                                      touchEnd$.pipe(switchMap(() => animationEndOn$)),\n                                      animationEndOn$.pipe(switchMap(() => touchEnd$)),\n                                  ),\n                        ),\n                        map(() => ripple),\n                    );\n                }),\n                takeUntil(destroy$),\n            )\n            .subscribe(element => {\n                renderer.setStyle(element, 'animationName', RIPPLE_OFF);\n            });\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiRippleDirective} from './ripple.directive';\nimport {TuiRippleStylesComponent} from './ripple-styles.component';\n\n@NgModule({\n    declarations: [TuiRippleDirective, TuiRippleStylesComponent],\n    exports: [TuiRippleDirective],\n})\nexport class TuiRippleModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["InjectionToken","TuiDestroyService","TUI_TOUCH_SUPPORTED","TUI_IS_IOS","ElementRef","Renderer2","EMPTY","tuiTypedFromEvent","map","tuiPx","filter","tuiIsPresent","takeUntil","i0","Component","ViewEncapsulation","ChangeDetectionStrategy","mergeMap","race","timer","ALWAYS_FALSE_HANDLER","ALWAYS_TRUE_HANDLER","take","tap","switchMap","TuiDirectiveStylesService","Directive","Inject","Self","Input","NgModule"],"mappings":"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"}