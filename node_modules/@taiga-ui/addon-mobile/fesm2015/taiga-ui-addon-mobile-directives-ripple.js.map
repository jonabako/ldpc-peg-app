{"version":3,"file":"taiga-ui-addon-mobile-directives-ripple.js","sources":["../../../projects/addon-mobile/directives/ripple/ripple.providers.ts","../../../projects/addon-mobile/directives/ripple/ripple-styles.component.ts","../../../projects/addon-mobile/directives/ripple/ripple.directive.ts","../../../projects/addon-mobile/directives/ripple/ripple.module.ts","../../../projects/addon-mobile/directives/ripple/taiga-ui-addon-mobile-directives-ripple.ts"],"sourcesContent":["import {ElementRef, InjectionToken, Provider, Renderer2} from '@angular/core';\nimport {\n    TUI_IS_IOS,\n    TUI_TOUCH_SUPPORTED,\n    TuiDestroyService,\n    tuiIsPresent,\n    tuiPx,\n    tuiTypedFromEvent,\n} from '@taiga-ui/cdk';\nimport {EMPTY, Observable} from 'rxjs';\nimport {filter, map, takeUntil} from 'rxjs/operators';\n\nexport const RIPPLE_ON = 'tuiRippleOn';\nexport const RIPPLE_OFF = 'tuiRippleOff';\n\n/**\n * Stream of ripple elements to add\n */\nexport const TUI_RIPPLE_START = new InjectionToken<Observable<HTMLElement>>(\n    '[TUI_RIPPLE_START]',\n);\n\n/**\n * Stream of ripple elements to remove\n */\nexport const TUI_RIPPLE_END = new InjectionToken<Observable<HTMLElement>>(\n    '[TUI_RIPPLE_END]',\n);\n\nexport const TUI_RIPPLE_PROVIDERS: Provider[] = [\n    TuiDestroyService,\n    {\n        provide: TUI_RIPPLE_START,\n        deps: [TUI_TOUCH_SUPPORTED, TUI_IS_IOS, ElementRef, Renderer2],\n        useFactory: (\n            touchSupported: boolean,\n            isIOS: boolean,\n            {nativeElement}: ElementRef<HTMLElement>,\n            renderer: Renderer2,\n        ): Observable<HTMLElement> =>\n            isIOS || !touchSupported\n                ? EMPTY\n                : tuiTypedFromEvent(nativeElement, 'touchstart').pipe(\n                      map(({touches}) => {\n                          const {clientX, clientY} = touches[touches.length - 1];\n                          const {width, height, top, left} =\n                              nativeElement.getBoundingClientRect();\n                          const radius = Math.sqrt(width * width + height * height);\n                          const dimension = radius * 2;\n                          const x = clientX - left - radius;\n                          const y = clientY - top - radius;\n                          const ripple = renderer.createElement('div');\n\n                          renderer.addClass(ripple, 'tui-ripple');\n                          renderer.setAttribute(\n                              ripple,\n                              'style',\n                              `width: ${tuiPx(dimension)}; height: ${tuiPx(\n                                  dimension,\n                              )}; left: ${tuiPx(x)}; top: ${tuiPx(\n                                  y,\n                              )}; animation-name: ${RIPPLE_ON};`,\n                          );\n\n                          return ripple;\n                      }),\n                  ),\n    },\n    {\n        provide: TUI_RIPPLE_END,\n        deps: [TUI_TOUCH_SUPPORTED, TUI_IS_IOS, ElementRef, TuiDestroyService],\n        useFactory: (\n            touchSupported: boolean,\n            isIOS: boolean,\n            {nativeElement}: ElementRef<HTMLElement>,\n            destroy$: Observable<void>,\n        ): Observable<EventTarget> =>\n            isIOS || !touchSupported\n                ? EMPTY\n                : tuiTypedFromEvent(nativeElement, 'animationend').pipe(\n                      filter(({animationName}) => animationName === RIPPLE_OFF),\n                      map(({target}) => target),\n                      filter(tuiIsPresent),\n                      takeUntil(destroy$),\n                  ),\n    },\n];\n","import {ChangeDetectionStrategy, Component, ViewEncapsulation} from '@angular/core';\n\n@Component({\n    host: {\n        class: 'tui-ripple-styles',\n    },\n    template: '',\n    styleUrls: ['./ripple.style.less'],\n    encapsulation: ViewEncapsulation.None,\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class TuiRippleStylesComponent {}\n","import {Directive, ElementRef, Inject, Input, Renderer2, Self} from '@angular/core';\nimport {\n    ALWAYS_FALSE_HANDLER,\n    ALWAYS_TRUE_HANDLER,\n    TuiDestroyService,\n    TuiDirectiveStylesService,\n    tuiTypedFromEvent,\n} from '@taiga-ui/cdk';\nimport {Observable, race, timer} from 'rxjs';\nimport {map, mergeMap, switchMap, take, takeUntil, tap} from 'rxjs/operators';\n\nimport {\n    RIPPLE_OFF,\n    TUI_RIPPLE_END,\n    TUI_RIPPLE_PROVIDERS,\n    TUI_RIPPLE_START,\n} from './ripple.providers';\nimport {TuiRippleStylesComponent} from './ripple-styles.component';\n\nconst TOUCH_MOVE_DELAY = 100;\n\n@Directive({\n    selector: '[tuiRipple]',\n    providers: TUI_RIPPLE_PROVIDERS,\n})\nexport class TuiRippleDirective {\n    @Input()\n    tuiRipple?: string | '';\n\n    constructor(\n        @Inject(ElementRef) {nativeElement}: ElementRef<HTMLElement>,\n        @Inject(TuiDirectiveStylesService) directiveStyles: TuiDirectiveStylesService,\n        @Inject(Renderer2) renderer: Renderer2,\n        @Self() @Inject(TuiDestroyService) destroy$: TuiDestroyService,\n        @Inject(TUI_RIPPLE_START) start$: Observable<HTMLElement>,\n        @Inject(TUI_RIPPLE_END) end$: Observable<EventTarget>,\n    ) {\n        directiveStyles.addComponent(TuiRippleStylesComponent);\n\n        const touchEnd$ = tuiTypedFromEvent(nativeElement, 'touchend');\n        const touchMove$ = tuiTypedFromEvent(nativeElement, 'touchmove');\n\n        end$.subscribe(element => {\n            renderer.removeChild(nativeElement, element);\n        });\n        start$\n            .pipe(\n                mergeMap(ripple => {\n                    const animationEndOn$ = tuiTypedFromEvent(ripple, 'animationend');\n\n                    return race(\n                        timer(TOUCH_MOVE_DELAY).pipe(map(ALWAYS_FALSE_HANDLER)),\n                        touchEnd$.pipe(map(ALWAYS_TRUE_HANDLER)),\n                    ).pipe(\n                        take(1),\n                        // eslint-disable-next-line rxjs/no-unsafe-takeuntil\n                        takeUntil(touchMove$),\n                        tap(() => {\n                            renderer.setStyle(\n                                ripple,\n                                'background',\n                                this.tuiRipple || null,\n                            );\n                            renderer.appendChild(nativeElement, ripple);\n                        }),\n                        switchMap(isTap =>\n                            isTap\n                                ? animationEndOn$\n                                : race(\n                                      touchEnd$.pipe(switchMap(() => animationEndOn$)),\n                                      animationEndOn$.pipe(switchMap(() => touchEnd$)),\n                                  ),\n                        ),\n                        map(() => ripple),\n                    );\n                }),\n                takeUntil(destroy$),\n            )\n            .subscribe(element => {\n                renderer.setStyle(element, 'animationName', RIPPLE_OFF);\n            });\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiRippleDirective} from './ripple.directive';\nimport {TuiRippleStylesComponent} from './ripple-styles.component';\n\n@NgModule({\n    declarations: [TuiRippleDirective, TuiRippleStylesComponent],\n    exports: [TuiRippleDirective],\n})\nexport class TuiRippleModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}