{"version":3,"file":"taiga-ui-addon-mobile-directives-touchable.js","sources":["../../../projects/addon-mobile/directives/touchable/touchable.directive.ts","../../../projects/addon-mobile/directives/touchable/touchable.module.ts","../../../projects/addon-mobile/directives/touchable/taiga-ui-addon-mobile-directives-touchable.ts"],"sourcesContent":["import {\n    Directive,\n    ElementRef,\n    Inject,\n    Input,\n    Optional,\n    Renderer2,\n    Self,\n} from '@angular/core';\nimport {TuiTouchMode} from '@taiga-ui/addon-mobile/types';\nimport {tuiFindTouchIndex} from '@taiga-ui/addon-mobile/utils';\nimport {TUI_IS_IOS, TuiDestroyService, tuiTypedFromEvent} from '@taiga-ui/cdk';\nimport {TUI_ELEMENT_REF} from '@taiga-ui/core';\nimport {race} from 'rxjs';\nimport {filter, map, switchMap, take, takeUntil, tap} from 'rxjs/operators';\n\nconst STYLE = {\n    transform: 'scale(0.95)',\n    opacity: '0.6',\n    background: 'rgba(146, 153, 162, 0.12)',\n} as const;\n\n@Directive({\n    selector: '[tuiTouchable]',\n    providers: [TuiDestroyService],\n})\nexport class TuiTouchableDirective {\n    @Input()\n    tuiTouchable: TuiTouchMode | '' = '';\n\n    constructor(\n        @Optional() @Inject(TUI_ELEMENT_REF) el: ElementRef<HTMLElement> | null,\n        @Inject(TUI_IS_IOS) isIos: boolean,\n        @Inject(ElementRef) {nativeElement}: ElementRef<HTMLElement>,\n        @Inject(Renderer2) renderer: Renderer2,\n        @Self() @Inject(TuiDestroyService) destroy$: TuiDestroyService,\n    ) {\n        if (!isIos) {\n            return;\n        }\n\n        const element = el?.nativeElement || nativeElement;\n\n        tuiTypedFromEvent(element, 'touchstart', {passive: true})\n            .pipe(\n                tap(() => {\n                    this.onTouchStart(renderer, element);\n                }),\n                map(({touches}) => touches[touches.length - 1].identifier),\n                switchMap(identifier =>\n                    race(\n                        tuiTypedFromEvent(element, 'touchmove', {passive: true}).pipe(\n                            filter(({touches}) =>\n                                this.hasTouchLeft(element, touches, identifier),\n                            ),\n                        ),\n                        tuiTypedFromEvent(element, 'touchend'),\n                    ).pipe(take(1)),\n                ),\n                takeUntil(destroy$),\n            )\n            .subscribe(() => {\n                renderer.removeStyle(element, 'transform');\n                renderer.removeStyle(element, 'opacity');\n                renderer.removeStyle(element, 'background');\n            });\n    }\n\n    get style(): TuiTouchMode {\n        return this.tuiTouchable || 'transform';\n    }\n\n    private hasTouchLeft(\n        element: HTMLElement,\n        touches: TouchList,\n        identifier: number,\n    ): boolean {\n        const {ownerDocument} = element;\n        const id = tuiFindTouchIndex(touches, identifier);\n\n        if (!ownerDocument || id === -1) {\n            return true;\n        }\n\n        const {clientX, clientY} = touches[id];\n\n        return !element.contains(ownerDocument.elementFromPoint(clientX, clientY));\n    }\n\n    private onTouchStart(renderer: Renderer2, element: HTMLElement): void {\n        if (this.style !== 'transform') {\n            renderer.removeStyle(element, 'transition');\n        } else {\n            renderer.setStyle(element, 'transition', 'transform 0.2s');\n        }\n\n        renderer.setStyle(element, this.style, STYLE[this.style]);\n    }\n}\n","import {NgModule} from '@angular/core';\n\nimport {TuiTouchableDirective} from './touchable.directive';\n\n@NgModule({\n    declarations: [TuiTouchableDirective],\n    exports: [TuiTouchableDirective],\n})\nexport class TuiTouchableModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}